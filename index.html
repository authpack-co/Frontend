<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuthPack</title>
    <link rel="shortcut icon" href="/src/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/src/styles/styles.css">
</head>

<body>
    <header>
        <a href="/" class="logo">AuthPack</a>
        <nav>
            <!-- <a href="#pricing">Pricing</a>
            <a href="#features">Features</a>
            <a href="#enterprise">Enterprise</a>
            <a href="#docs">Docs</a> -->
        </nav>
        <div class="buttons">
            <!-- <button class="btn btn-signin">Sign in</button> -->
            <a href="/docs/">Docs</a>
            <button class="btn btn-download">Download</button>
        </div>
    </header>

    <section class="hero">
        <h1>Gerencie sessões como um profissional</h1>
        <p>O AuthPack simplifica a autenticação, organiza seus acessos e garante segurança máxima em cada conexão.</p>
        <div class="buttons">
            <button class="btn-primary">
                <span class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-download-icon lucide-download">
                        <path d="M12 15V3" />
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <path d="m7 10 5 5 5-5" />
                    </svg>
                </span>
                <span class="btn-text">
                    Baixar para Chrome
                </span>
            </button>
            <div class="dropdown">
                <button class="btn-secondary" onclick="toggleMenu()">Todas as versões</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="dropdown-item selected">Chrome</div>
                    <div class="dropdown-item">.CRX</div>
                </div>
            </div>
        </div>
        <div class="placeholder-img"></div>
    </section>

    <footer>
        <div class="footer-container">
            <div class="footer-left">
                <h3>AuthPack</h3>
                <p>Gerencie sessões com segurança e praticidade.</p>
            </div>

            <div class="footer-center">
                <a href="#">Docs</a>
                <a href="#">Suporte</a>
                <a href="#">Contato</a>
            </div>

            <div class="footer-right">
                <p>© 2025 AuthPack. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>


    <script>
        function toggleMenu() {
            const menu = document.getElementById("dropdownMenu");
            menu.classList.toggle("show");
        }


        // Fecha o menu ao clicar fora
        window.addEventListener("click", function (e) {
            if (!e.target.closest('.dropdown')) {
                const menu = document.getElementById("dropdownMenu");
                if (menu.classList.contains("show")) {
                    menu.classList.remove("show");
                }
            }
        });


        // Troca de seleção ao clicar
        document.querySelectorAll(".dropdown-item").forEach(item => {
            item.addEventListener("click", () => {
                const itemName = item.textContent;
                const downloadButtonText = document.querySelector(".hero .btn-primary .btn-text");
                downloadButtonText.textContent = `Baixar para ${itemName}`;

                document.querySelectorAll(".dropdown-item").forEach(i => i.classList.remove("selected"));
                item.classList.add("selected");
            });
        });

        const mainDownloadButton = document.querySelector(".hero .btn-primary");
        mainDownloadButton.addEventListener("click", () => {
            downloadButtonText = mainDownloadButton.textContent.trim();

            console.log(downloadButtonText)

            switch(downloadButtonText) {
                case "Baixar para Chrome": downloadExtension("http://localhost:3000/api/extensions/chrome/build")
                break;
            }
        });

        async function downloadExtension(route) {
            try {
                const response = await fetch(route, {
                    method: "POST"
                });

                if (!response.ok) {
                    console.error("Erro ao baixar:", response.statusText);
                    return;
                }

                const blob = await response.blob(); // <- só sai daqui quando terminou de baixar

                // Tenta extrair o nome do arquivo do header "Content-Disposition"
                const contentDisposition = response.headers.get("Content-Disposition");
                let filename = "AuthPack.zip"; // fallback

                if (contentDisposition) {
                    const match = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
                    if (match && match[1]) {
                        filename = match[1].replace(/['"]/g, '');
                    }
                }

                // Cria o link temporário e dispara o download
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);

                window.open("http://127.0.0.1:5500/docs/?go=install")

            } catch (error) {
                console.error("Erro inesperado ao baixar:", error);
            }
        }
    </script>
</body>

</html>